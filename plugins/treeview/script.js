(function(a){a.extend(a.fn,{treeView:function(b){function m(c,j){function i(f){var e=f[3],g=a('<li><div class="'+(f[1]?"hitarea collapsed":"placeholder")+'"><div class="arrow"/><div class="'+f[2]+'"/></div><a href="'+e+'">'+f[4]+"</a></li>"),d=g.children(".hitarea");g.data("name",f[4]).data("tree",f[0]?1:0);d.click(function(){if(d.hasClass("collapsed")){m(g,e);d.removeClass("collapsed").addClass("expanded")}else{g.children("ul").hide();d.removeClass("expanded").addClass("collapsed")}p(e,d.hasClass("expanded"));
return false});if(q(e)){m(g,e);d.removeClass("collapsed").addClass("expanded")}return g}function k(f){var e=a("<ul></ul>");a.each(f,function(g,d){e.append(i(d))});j==b.root&&c.empty();c.children("ul").remove();c.removeClass("wait").append(e)}function r(f){var e={},g=[];a.each(f,function(d,h){e[h[4]]=h});a("> ul > li",c).each(function(){var d=a(this),h=d.data("name");if(e[h])delete e[h];else d.remove();g.push(a(this))});a.each(e,function(d,h){var o=false;a.each(g,function(s,l){if(h[0]&&!l.data("tree")||
d<l.data("name")&&h[0]==l.data("tree")){o=true;l.before(i(h));return false}});o||c.children("ul").append(i(h))})}if(c.children("ul").length!=0)c.children("ul").show();else{c.addClass("wait");if(b.counterStore){var n=a.store.get(b.counterStore,0);a.ajax({url:b.url,data:{dir:j,_:n},dataType:"json",type:"GET",success:k});setTimeout(function(){a.ajax({url:b.url,data:{dir:j,_:n+1},dataType:"json",type:"GET",success:function(f){a.store.set(b.counterStore,n+1);r(f)}})},b.delay)}else a.ajax({url:b.url,data:{dir:j},
dataType:"json",type:"GET",success:k})}}function q(c){return b.stateStore&&a.inArray(c,a.store.get(b.stateStore,[]))>=0}function p(c,j){if(b.stateStore){var i=a.store.get(b.stateStore,[]);if(j)a.inArray(c,i)<0&&i.push(c);else i=a.grep(i,function(k){return k!=c});a.store.set(b.stateStore,i)}}b||(b={});if(!b.root)b.root="/";if(!b.url)b.url="/_/treeview.json";if(!b.delay)b.delay=1E3;this.each(function(){m(a(this),b.root)})}})})(jQuery);$.translations({en:{menu:"Menu",tree:"Tree"},de:{menu:"Men\u00fc",tree:"Baumansicht"}});
$(function(){sidebar=$("#sidebar");sidebar.html('<div id="treeview-tabs"><ul><li class="tabs-selected"><a href="#sidebar-menu">'+$.t("menu")+'</a></li><li><a href="#sidebar-treeview">'+$.t("tree")+'</a></li></ul></div><div id="sidebar-treeview"><h1>'+$.t("tree")+'</h1><div id="treeview"></div></div><div id="sidebar-menu">'+sidebar.html()+"</div>");$("#treeview-tabs").tabs({store:"treeview-tabs"});$("#treeview").treeView({stateStore:"treeview-state",counterStore:"treeview-counter"})});
