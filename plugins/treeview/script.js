(function(a){a.extend(a.fn,{treeView:function(b){if(!b){b={}}if(!b.root){b.root="/"}if(!b.url){b.url="/_/treeview.json"}if(!b.delay){b.delay=1000}function d(h,j){if(h.children("ul").length!=0){h.children("ul").show();return}h.addClass("wait");function f(m){var n=m[3],o=a('<li name="'+m[4]+'" tree="'+(m[0]?1:0)+'"><div class="'+(m[1]?"hitarea collapsed":"placeholder")+'"><div class="arrow"/><div class="'+m[2]+'"/></div><a href="'+n+'">'+m[4]+"</a></li>"),l=o.children(".hitarea");l.click(function(){if(l.hasClass("collapsed")){d(o,n);l.removeClass("collapsed").addClass("expanded")}else{o.children("ul").hide();l.removeClass("expanded").addClass("collapsed")}c(n,l.hasClass("expanded"));return false});if(e(n)){d(o,n);l.removeClass("collapsed").addClass("expanded")}return o}function i(m){var l=a("<ul></ul>");a.each(m,function(n,o){l.append(f(o))});if(j==b.root){h.empty()}h.children("ul").remove();h.removeClass("wait").append(l)}function k(n){var l={},m=[];a.each(n,function(o,p){l[p[4]]=p});a("> ul > li",h).each(function(){var o=a(this),p=o.attr("name");if(!l[p]){o.remove()}else{delete l[p]}m.push(a(this))});a.each(l,function(o,q){var p=false;a.each(m,function(s,r){if((q[0]&&!r.attr("tree"))||(o<r.attr("name")&&q[0]==r.attr("tree"))){p=true;r.before(f(q));return false}});if(!p){h.children("ul").append(f(q))}})}if(b.counterStore){var g=a.store.get(b.counterStore,0);a.ajax({url:b.url,data:{dir:j,_:g},dataType:"json",type:"GET",success:i});setTimeout(function(){a.ajax({url:b.url,data:{dir:j,_:g+1},dataType:"json",type:"GET",success:function(l){a.store.set(b.counterStore,g+1);k(l)}})},b.delay)}else{a.ajax({url:b.url,data:{dir:j},dataType:"json",type:"GET",success:i})}}function e(f){return b.stateStore&&a.inArray(f,a.store.get(b.stateStore,[]))>=0}function c(h,f){if(b.stateStore){var g=a.store.get(b.stateStore,[]);if(!f){g=a.grep(g,function(k,j){return k!=h})}else{if(a.inArray(h,g)<0){g.push(h)}}a.store.set(b.stateStore,g)}}this.each(function(){d(a(this),b.root)})}})})(jQuery);$(function(){if($.browser.mozilla||$.browser.safari){sidebar=$("#sidebar");sidebar.html('<div id="treeview-tabs"><ul><li class="tabs-selected"><a href="#sidebar-menu">Menu</a></li><li><a href="#sidebar-treeview">Tree</a></li></ul></div><div id="sidebar-treeview"><h1>Tree</h1><div id="treeview"></div></div><div id="sidebar-menu">'+sidebar.html()+"</div>");$("#treeview-tabs").tabs({store:"treeview-tabs"});$("#treeview").treeView({stateStore:"treeview-state",counterStore:"treeview-counter"})}});