- if page.new?
  - title params[:path].blank? ? :new_page.t : "#{:new_page.t}: #{params[:path]}"
- else
  - title params[:pos] ? :edit_page_section.t(:page => page.title) : :edit_page.t(:page => page.title)
%h1&= title
.tabs
  %ul
    = tab :edit
    = tab :upload
    = tab :attributes
  %form(action='#{absolute_path page}' method='post')
    #tab-edit.box
      %h2&= :edit.t
      = flash_messages if action? :edit
      %input(type='hidden' name='action' value='edit')
      - if page.new?
        %label(for='edit-path')&= :path.t
        %input#edit-path(name='path' type='text' value='#{params[:path]}')
        %br
      - else
        %input(type='hidden' name='version' value='#{page.version}')
        - if params[:pos]
          %input(type='hidden' name='pos' value='#{params[:pos]}')
          - if params[:len]
            %input(type='hidden' name='len' value='#{params[:len]}')
      %label(for='edit-content')&= :content.t
      %br
      %textarea#edit-content(name='content' cols='100' rows='20')&= edit_content(page)
      %br
      %label(for='edit-comment')&= :comment.t
      %input#edit-comment(type='text' name='comment' value='#{params[:comment]}' size='50')
      %button(type='submit')&= :save.t
      %button(type='submit' name='close' value='1')&= :save_and_close.t
      %button(type='reset')&= :reset.t
      %br
  %form(action='#{absolute_path page}' method='post' enctype='multipart/form-data')
    #tab-upload.box
      %input(type='hidden' name='action'  value='upload')
      %h2&= :upload_file.t
      - if page.new?
        %label(for='upload-path')&= :path.t
        %input#upload-path(name='path' type='text' value='#{params[:path]}')
        %br
      - else
        %input(type='hidden' name='version' value='#{page.version}')
        - if page.content
          %p= :upload_warning.t
      = flash_messages if action? :upload
      %label(for='upload-file')&= :file.t
      %input#upload-file(name='file' type='file')
      %br
      %button(type='submit')&= :save.t
      %button(type='submit' name='close' value='1')&= :save_and_close.t
      %button(type='reset')&= :reset.t
      %br
  %form(action='#{absolute_path page}' method='post')
    #tab-attributes.box.fieldset
      %input(type='hidden' name='action'  value='attributes')
      %h2&= :attributes.t
      - if page.new?
        %label(for='attributes-path')&= :path.t
        %input#attributes-path(name='path' type='text' value='#{params[:path]}')
        %br
      - else
        %input(type='hidden' name='version' value='#{page.version}')
      = flash_messages if action? :attributes
      = attribute_editor(page.attributes)
      %button(type='submit')&= :save.t
      %button(type='submit' name='close' value='1')&= :save_and_close.t
      %button(type='reset')&= :reset.t
      %br
